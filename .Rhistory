library(scoccer)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
View(t)
library(scoccer)
View(t)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
library(scoccer)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
View(t)
library(scoccer)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
View(t)
library(scoccer)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
View(t)
View(t)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
library(scoccer)
sco_bayesian_calibration("sco_ch","1819",.5,0.5) -> t
View(t)
a <- seq(0.3,0.5,0.05)
a
b <- seq(0.5,0.7,0.05)
expand.grid(a,b)
expand.grid(a,b) -> c
purrr::pmap_df(list("sco_ch","1819",c$Var1,c$Var2), sco_bayesian_calibration) -> d
View(d)
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(win_pct = sum(win)/sum(play))
library(magrittr)
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(win_pct = sum(win)/sum(play))
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(win_pct = sum(win,na.rm = TRUE)/sum(play,na.rm = TRUE))
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(plays = sum(play,na.rm = TRUE),win_pct = sum(win,na.rm = TRUE)/sum(play,na.rm = TRUE))
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(plays = sum(play,na.rm = TRUE),win_pct = sum(win,na.rm = TRUE)/sum(play,na.rm = TRUE)) -> e
View(e)
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(plays = sum(play,na.rm = TRUE),wins = sum(win,na.rm = TRUE)) -> e
View(e)
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == TRUE & play == case, TRUE,FALSE)) %>% dplyr::summarise(plays = sum(play,na.rm = TRUE),wins = sum(win,na.rm = TRUE)) -> e
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == TRUE & play == case, TRUE,FALSE)) %>% dplyr::summarise(plays = sum(play,na.rm = TRUE),wins = sum(win,na.rm = TRUE), pcy = wins/plays) -> e
View(e)
d %>% dplyr::group_by(tresh) %>% dplyr::mutate(win = dplyr::if_else(play == case, TRUE,FALSE)) %>% dplyr::summarise(win_pct = sum(win)/sum(play))
plot(e$tresh,e$pcy)
plot(e$tresh,e$pcy, type = "h")
View(e)
plot(e$pcy,e$tresh, type = "h")
plot(factor(e$tresh),e$pcy, type = "h")
plot(e$pcy,factor(e$tresh), type = "h")
plot(e$pcy,factor(e$tresh), type = "b")
plot(e$pcy,factor(e$tresh))
plot(factor(e$tresh),e$pcy, type = "h")
plot(factor(e$tresh),e$pcy, type = "b")
plot(factor(e$tresh),e$pcy, type = "l")
plot(factor(e$tresh),e$pcy, type = "bar")
plot(e$tresh,e$pcy, type = "bar")
plot(as.character(e$tresh),e$pcy, type = "bar")
plot(as.factor(e$tresh),e$pcy, type = "bar")
plot(as.factor(e$tresh),e$pcy, type = "l")
View(e)
library(scoccer)
devtools::document(".")
devtools::document(".")
library(scoccer)
library(scoccer)
sco_bayesian_calibration("sco_ch","1819") -> t
devtools::document(".")
library(scoccer)
sco_bayesian_calibration("sco_ch","1819") -> t
devtools::use_package("purrr")
library(scoccer)
sco_bayesian_calibration("sco_ch","1819") -> t
View(t)
5*1
3/5
5
5/3
devtools::document(".")
library(scoccer)
library(scoccer)
library(scoccer)
sco_bayesian_btts("1819","sco_pl","awayteam","Celtic")
sco_bayesian_btts("1819","sco_pl","hometeam","Celtic")
sco_bayesian_btts("1819","sco_pl","awayteam","Kilmarnock")
setwd("Z:/git/scoccer")
library(scoccer)
devtools::use_package("ggplot2")
devtools::use_package("scales")
devtools::use_package("viridis")
devtools::document(".")
library(scoccer)
sco_ref_card_plot("1718","sco_ch")
library(scoccer)
sco_ref_card_plot("1718","sco_ch")
library(scoccer)
sco_ref_card_plot("1718","sco_ch")
library(scoccer)
devtools::document(".")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
sco_acquire("1819","sco_ch") %>%
dplyr::select(date,team = hometeam,val = stat_input_home) %>%
dplyr::mutate(ven = "home") %>%
dplyr::group_by(team) %>%
dplyr::arrange(desc(date)) %>%
dplyr::filter(ven == 'home') %>%
dplyr::group_by(team,ven) %>%
dplyr::arrange(date) %>%
dplyr::mutate(matchs = 1:n()) %>% na.omit()
library(dplyr)
sco_acquire("1819","sco_ch") %>%
dplyr::select(date,team = hometeam,val = stat_input_home) %>%
dplyr::mutate(ven = "home") %>%
dplyr::group_by(team) %>%
dplyr::arrange(desc(date)) %>%
dplyr::filter(ven == 'home') %>%
dplyr::group_by(team,ven) %>%
dplyr::arrange(date) %>%
dplyr::mutate(matchs = 1:n()) %>% na.omit()
sco_acquire("1819","sco_ch") %>%
dplyr::select(date,team = hometeam,val = hs) %>%
dplyr::mutate(ven = "home") %>%
dplyr::group_by(team) %>%
dplyr::arrange(desc(date)) %>%
dplyr::filter(ven == 'home') %>%
dplyr::group_by(team,ven) %>%
dplyr::arrange(date) %>%
dplyr::mutate(matchs = 1:n()) %>% na.omit()
sco_acquire("1819","sco_ch") %>%
dplyr::select(date,team = hometeam,val = hs) %>%
dplyr::mutate(ven = "home") %>%
dplyr::group_by(team) %>%
dplyr::arrange(desc(date)) %>%
dplyr::filter(ven == 'home') %>%
dplyr::group_by(team,ven) %>%
dplyr::arrange(date) %>%
dplyr::mutate(matchs = 1:dplyr::n()) %>% na.omit()
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
sco_misc_stats_develop("hs","as","1819","sco_ch")
sco_misc_stats_develop("hs","as","1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","1819","sco_ch")
sco_misc_stats_develop("hs","as","1819","sco_pl")
sco_misc_stats_develop("hs","as","1819","sco_ch")
sco_misc_stats_develop("hs","as","1819","sco_ch")
sco_misc_stats_develop("hs","as","1011","sco_pl")
library(dplyr)
library(magrittr)
library(viridis)
library(lubridate)
library(stringr)
library(ggplot2)
library(scales)
library(purrr)
library(tidyr)
library(scoccer)
# data of each ref
sco_acquire("1819","sco_pl") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(referee,card_group = cards) %>%
tally() -> each_ref # d
each_ref
# data of each ref
sco_acquire("1819","sco_pl") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(hometeam,card_group = cards) %>%
tally() -> each_ref
each_ref
# data of each ref
sco_acquire("1819","sco_pl") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = hometeam,card_group = cards) %>%
tally() -> each_ref
# total data
each_ref %>%
group_by(referee) %>%
summarise(n_total = sum(n)) -> total_ref
each_ref
# data of each ref
sco_acquire("1819","sco_pl") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = hometeam,card_group = cards) %>%
tally() %>%
mutate(ven = 'home') -> each_ref
# data of each ref
sco_acquire("1819","sco_pl") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = hometeam,card_group = cards) %>%
tally() %>%
mutate(ven = 'home') -> each_home_team
# total data
each_home_team %>%
group_by(hometeam) %>%
summarise(n_total = sum(n)) -> total_home_teal
# total data
each_home_team %>%
group_by(team) %>%
summarise(n_total = sum(n)) -> total_home_team
total_home_team
# join, calculate share and plot
left_join(each_home_team,each_home_team, by = NULL) %>% mutate(pct = n/n_total)
total_home_team
# join, calculate share and plot
left_join(each_home_team,each_home_team, by = NULL) %>% mutate(pct = n/n_total)
# join, calculate share and plot
left_join(each_home_team,total_home_team, by = NULL) %>% mutate(pct = n/n_total)
sco_acquire("1819","sco_pl") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = awayteam,card_group = cards) %>%
tally() %>%
mutate(ven = 'away') -> each_away_team
each_away_team
# total data
each_home_team %>%
group_by(team) %>%
summarise(n_total = sum(n)) -> total_away_team
left_join(each_away_team,total_away_team, by = NULL) %>% mutate(pct = n/n_total) -> away
bind_rows(home,away)
# join, calculate share and plot
left_join(each_home_team,total_home_team, by = NULL) %>% mutate(pct = n/n_total) -> home
bind_rows(home,away)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(home," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(12))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ ",league_input), subtitle = year_input) +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(home," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(12))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(home," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity")
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(12))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
sco_acquire("1819","sco_ch") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = hometeam,card_group = cards) %>%
tally() %>%
mutate(ven = 'home') -> each_home_team
# total data
each_home_team %>%
group_by(team) %>%
summarise(n_total = sum(n)) -> total_home_team
# join, calculate share and plot
left_join(each_home_team,total_home_team, by = NULL) %>% mutate(pct = n/n_total) -> home
sco_acquire("1819","sco_ch") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = awayteam,card_group = cards) %>%
tally() %>%
mutate(ven = 'away') -> each_away_team
# total data
each_home_team %>%
group_by(team) %>%
summarise(n_total = sum(n)) -> total_away_team
left_join(each_away_team,total_away_team, by = NULL) %>% mutate(pct = n/n_total) -> away
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
#scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team)))))+1 +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team)))+1)) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))+1) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
(length(unique(home$team))
rev(viridis_pal(option = "B")(length(unique(home$team))))
rev(viridis_pal(option = "B")(length(unique(home$team))))
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$n))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(12))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
devtools::document(".")
sco_team_card_plot("1819","sco_pl")
sco_team_card_plot("1819","sco_pl")
devtools::document(".")
scoccer::sco_team_card_plot("1819","sco_pl")
scoccer::sco_team_card_plot("1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","15/16","sco_ch")
sco_misc_stats_develop("hs","as","14/15","sco_ch")
sco_misc_stats_develop("hs","as","1415","sco_ch")
sco_misc_stats_develop("hs","as","1415","sco_pl")
sco_team_card_plot("1819","sco_ch")
library(scoccer)
sco_team_card_plot("1819","sco_ch")
library(scoccer)
sco_team_card_plot("1819","sco_ch")
devtools::document(".")
sco_acquire("1819","sco_pl")
ebsales::acquire_sales("2019-06-10","2019-06-10") -> t
View(t)
devtools::document(".")
library(scoccer)
library(scoccer)
suppressMessages(sco_poisson_xg_calibration("1819","sco_pl",4,5))
devtools::document(".")
sco_acquire("1819","sco_pl") -> t
library(tidyverse)
library(magrittr)
t %>% filter(hometeam == 'Celtic')
t %>% filter(hometeam == 'Celtic' & ftag == 0)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp)/n)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp)/n)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, 1, 0)) %>% summarise(x = sum(grp)/n)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp)/n())
1/1.68
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(pct = n()/sum(grp))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
t %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
t %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
sco_acquire("1718","sco_pl") %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
seq(10,19,1)
as.character(seq(10,19,1))
paste0(as.character(seq(10,18,1)),as.character(seq(11,19,1))
paste0(as.character(seq(10,18,1)),as.character(seq(11,19,1)))
paste0(as.character(seq(10,18,1)),as.character(seq(11,19,1))) -> a
x <- function(input) {
sco_acquire(input,"sco_pl") %>%
mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
}
map_df(a,x) -> y
View(y)
View(y)
x <- function(input) {
sco_acquire(input,"sco_pl") %>%
mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input) %>% group_by(hometeam,y) %>% summarise(desired_odds = n()/sum(grp))
}
map_df(a,x) -> y
ggplot(y,aes(x = y, y = desired_odds, color = hometeam)) + geom_line() + facet_wrap(~hometeam)
ggplot(y,aes(x = y, y = desired_odds, color = hometeam, group = 1)) + geom_line() + facet_wrap(~hometeam)
x <- function(input) {
sco_acquire(input,"sco_pl") -> data
data %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input, ven = 'home') %>% group_by(y,ven) %>% summarise(desired_odds = n()/sum(grp)) -> home
data %>% filter(awayteam == 'Celtic') %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input, ven = 'away') %>% group_by(y,ven) %>% summarise(desired_odds = n()/sum(grp)) -> away
bind_rows(home,away) -> d
return(d)
}
map_df(a,x) -> y
ggplot(y,aes(x = y, y = desired_odds, color = hometeam, group = 1)) + geom_line() + facet_wrap(~ven)
y
x <- function(input) {
sco_acquire(input,"sco_pl") -> data
data %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input, ven = 'home') %>% group_by(y,ven) %>% summarise(desired_odds = n()/sum(grp)) -> home
data %>% filter(awayteam == 'Celtic') %>% mutate(grp = if_else(ftag > 0 & fthg == 0, TRUE, FALSE), y = input, ven = 'away') %>% group_by(y,ven) %>% summarise(desired_odds = n()/sum(grp)) -> away
bind_rows(home,away) -> d
return(d)
}
map_df(a,x) -> y
y
ggplot(y,aes(x = y, y = desired_odds, color = hometeam, group = 1)) + geom_line() + facet_wrap(~ven)
ggplot(y,aes(x = y, y = desired_odds, color = ven, group = 1)) + geom_line() + facet_wrap(~ven)
ggplot(y,aes(x = y, y = desired_odds, color = ven, group = 1)) + geom_line() + geom_bar() + facet_wrap(~ven)
ggplot(y,aes(x = y, y = desired_odds, color = ven, group = 1)) + geom_line() + geom_bar(stat = "identity") + facet_wrap(~ven)
ggplot(y,aes(x = y, y = desired_odds, fill = ven, group = 1)) + geom_line() + geom_bar(stat = "identity") + facet_wrap(~ven)
y
y %>% group_by(ven) %>% summarise(x = mean(desired_odds))
a <- c('Dundee','Hamilton','Motherwell','Celtic','Hibernian','Kilmarnock')
b <- c('St Mirren','St Johnstone','Livingston','Hearts','Aberdeen','Rangers')
for(i in 1:length(a)) {
# for one
if(i == 1) {base_plot_data <- suppressMessages(sco_poisson_xg_predictions(sco_relative_strength("1819","sco_pl",a[i],b[i],4)))} else {
# for two or more
dplyr::bind_rows(
suppressMessages(sco_poisson_xg_predictions(sco_relative_strength("1819","sco_pl",a[i],b[i],4))),
base_plot_data) -> base_plot_data
}
}
ggplot2::ggplot(base_plot_data,ggplot2::aes(x = goals, y = pct, color = position, group = position)) +
ggplot2::geom_line() +
ggplot2::geom_point() +
ggplot2::theme_minimal() +
ggplot2::scale_y_continuous(labels = scales::percent) +
ggplot2::theme(legend.title = ggplot2::element_blank()) +
ggplot2::labs(x = "", y = "") +
ggplot2::scale_color_brewer(palette = "Set1") +
ggplot2::facet_wrap(~matchup) +
ggplot2::labs(title = "Predictions")
suppressMessages(sco_poisson_xg_calibration("1819","sco_ch",1,10))
