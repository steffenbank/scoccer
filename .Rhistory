theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(12))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
sco_acquire("1819","sco_ch") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = hometeam,card_group = cards) %>%
tally() %>%
mutate(ven = 'home') -> each_home_team
# total data
each_home_team %>%
group_by(team) %>%
summarise(n_total = sum(n)) -> total_home_team
# join, calculate share and plot
left_join(each_home_team,total_home_team, by = NULL) %>% mutate(pct = n/n_total) -> home
sco_acquire("1819","sco_ch") %>%
mutate(cards = hy + ay + hr + ar) %>%
mutate(card_group = if_else(cards %in% c(0,1,2), "0 - 2",
if_else(cards %in% c(3,4), "3 - 4",
if_else(cards %in% c(5,6), "5 - 6","6 - ")))) %>%
group_by(team = awayteam,card_group = cards) %>%
tally() %>%
mutate(ven = 'away') -> each_away_team
# total data
each_home_team %>%
group_by(team) %>%
summarise(n_total = sum(n)) -> total_away_team
left_join(each_away_team,total_away_team, by = NULL) %>% mutate(pct = n/n_total) -> away
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
#scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team)))))+1 +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team)))+1)) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$team))))+1) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
(length(unique(home$team))
rev(viridis_pal(option = "B")(length(unique(home$team))))
rev(viridis_pal(option = "B")(length(unique(home$team))))
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(length(unique(home$n))))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
bind_rows(home,away) %>%
ggplot(.,aes(x = paste0(team," (",n_total,")"), fill = as.factor(card_group), y = pct)) +
geom_bar(stat = "identity") +
coord_flip() +
scale_y_continuous(labels=percent) +
theme_minimal() +
scale_fill_manual(values = rev(viridis_pal(option = "B")(12))) +
labs(x = "", y = "", title = paste0("Times cards given by ref @ "), subtitle = "x") +
theme(legend.title = element_blank()) +
facet_wrap(~ven)
devtools::document(".")
sco_team_card_plot("1819","sco_pl")
sco_team_card_plot("1819","sco_pl")
devtools::document(".")
scoccer::sco_team_card_plot("1819","sco_pl")
scoccer::sco_team_card_plot("1819","sco_ch")
library(scoccer)
sco_misc_stats_develop("hs","as","15/16","sco_ch")
sco_misc_stats_develop("hs","as","14/15","sco_ch")
sco_misc_stats_develop("hs","as","1415","sco_ch")
sco_misc_stats_develop("hs","as","1415","sco_pl")
sco_team_card_plot("1819","sco_ch")
library(scoccer)
sco_team_card_plot("1819","sco_ch")
library(scoccer)
sco_team_card_plot("1819","sco_ch")
devtools::document(".")
sco_acquire("1819","sco_pl")
ebsales::acquire_sales("2019-06-10","2019-06-10") -> t
View(t)
devtools::document(".")
library(scoccer)
library(scoccer)
suppressMessages(sco_poisson_xg_calibration("1819","sco_pl",4,5))
devtools::document(".")
sco_acquire("1819","sco_pl") -> t
library(tidyverse)
library(magrittr)
t %>% filter(hometeam == 'Celtic')
t %>% filter(hometeam == 'Celtic' & ftag == 0)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp)/n)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp)/n)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, 1, 0)) %>% summarise(x = sum(grp)/n)
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(x = sum(grp)/n())
1/1.68
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% summarise(pct = n()/sum(grp))
t %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
t %>% mutate(grp = if_else(ftag == 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
t %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
sco_acquire("1718","sco_pl") %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE)) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
seq(10,19,1)
as.character(seq(10,19,1))
paste0(as.character(seq(10,18,1)),as.character(seq(11,19,1))
paste0(as.character(seq(10,18,1)),as.character(seq(11,19,1)))
paste0(as.character(seq(10,18,1)),as.character(seq(11,19,1))) -> a
x <- function(input) {
sco_acquire(input,"sco_pl") %>%
mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input) %>% group_by(hometeam) %>% summarise(desired_odds = n()/sum(grp))
}
map_df(a,x) -> y
View(y)
View(y)
x <- function(input) {
sco_acquire(input,"sco_pl") %>%
mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input) %>% group_by(hometeam,y) %>% summarise(desired_odds = n()/sum(grp))
}
map_df(a,x) -> y
ggplot(y,aes(x = y, y = desired_odds, color = hometeam)) + geom_line() + facet_wrap(~hometeam)
ggplot(y,aes(x = y, y = desired_odds, color = hometeam, group = 1)) + geom_line() + facet_wrap(~hometeam)
x <- function(input) {
sco_acquire(input,"sco_pl") -> data
data %>% filter(hometeam == 'Celtic') %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input, ven = 'home') %>% group_by(y,ven) %>% summarise(desired_odds = n()/sum(grp)) -> home
data %>% filter(awayteam == 'Celtic') %>% mutate(grp = if_else(ftag == 0 & fthg > 0, TRUE, FALSE), y = input, ven = 'away') %>% group_by(y,ven) %>% summarise(desired_odds = n()/sum(grp)) -> away
bind_rows(home,away) -> d
return(d)
}
map_df(a,x) -> y
devtools::load_all(".")
sco_bet_acquire("1920","sco_pl") -> t
View(t)
sco_standings("1920","sco_pl","2019-10-29")
ebzouora
ebzuora::cos_churn_credit("2020-01-01","2020-01-01")
# Dependencies ------------------------------------------------------------
library(magrittr)
library(dplyr)
library(ebawsconnectR)
library(tidyr)
library(ebsales)
library(lubridate)
library(stringr)
library(ggplot2)
library(ebmisc)
library(readr)
library(DBI)
library(ebmarketshares)
# Inputs ------------------------------------------------------------------
con <- dfp_con()
from_date <- '2018-12-31'
# Get sessions per day ----------------------------------------------------
dbGetQuery(con$con,  paste0("SELECT dt, COUNT(*) as sessions
FROM ekstrabladet_dsa_prv_external.ga360_web_session
WHERE dt > '",from_date,"' GROUP BY 1")) -> session_data
# Find correlatives [gratis] -------------------------------------------------------
dbGetQuery(con$con,  paste0("SELECT dt, COUNT(*) as pageviews
FROM ekstrabladet_dsa_prv_external.ga360_web_pageview
WHERE dt > '",from_date,"' GROUP BY 1")) -> pageviews
pageviews
left_join(session_data, pageviews)
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line()
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt))) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line() + facet_wrap(~q)
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt)), y = quarter(ymd(dt))) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line() + facet_wrap(~paste0(y,q))
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt)), y = year(ymd(dt))) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line() + facet_wrap(~paste0(y,q))
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt)), y = year(ymd(dt))) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line() + facet_wrap(~paste0(y,q), scales = "free_x")
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt)), y = year(ymd(dt))) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line()
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt)), y = year(ymd(dt))) %>%
ggplot(.,aes(x = dt, y = x, group = 1)) + geom_line() + geom_smooth()
left_join(session_data, pageviews) -> t
View(t)
left_join(session_data, pageviews) %>%
mutate(x = pageviews/sessions, q = quarter(ymd(dt)), y = year(ymd(dt))) -> t
View(t)
t %>% mutate(grp = if_else(ymd(dt) > '2020-01-23',TRUE,FALSE))
t %>% mutate(grp = if_else(ymd(dt) > '2020-01-23',TRUE,FALSE)) %>% group_by(grp) %>% summarise(mean(pageviews),mean(sessions),mean(x))
t %>% mutate(grp = if_else(ymd(dt) > '2020-01-23',TRUE,FALSE)) -> tmodel
lm(x~grp, data = tmodel) -> m1
anova(m1)
ggplot(tmodel, aes(x = grp, y = x)) + geom_boxplot()
summary(m1)
500/1300
500/13000
1300/10
dbGetQuery(con$con,  paste0("SELECT ga_hour,dt, COUNT(*) as sessions
FROM ekstrabladet_dsa_prv_external.ga360_web_session
WHERE dt > '",from_date,"' GROUP BY 1,2")) -> session_data
# Find correlatives [gratis] -------------------------------------------------------
dbGetQuery(con$con,  paste0("SELECT ga_hour,dt, COUNT(*) as pageviews
FROM ekstrabladet_dsa_prv_external.ga360_web_pageview
WHERE dt > '",from_date,"' GROUP BY 1,2")) -> pageviews
pageviews
View(pageviews)
pagaeviews %>% mutate(grp = if_else(ymd(dt) > '2020-01-23',TRUE,FALSE)) -> tmodel
pageviews %>% mutate(grp = if_else(ymd(dt) > '2020-01-23',TRUE,FALSE)) -> tmodel
View(pageviews)
tmodel
tmodel %>% group_by(ga_hour, grp) %>% summarise(x = mean(pageviews))
tmodel %>% group_by(ga_hour, grp) %>% summarise(x = mean(pageviews)) %>% ggplot(.,aes(x = ga_hour, y = x, color = grp)) + geom_line()
tmodel %>% group_by(ga_hour, grp) %>% summarise(x = mean(pageviews)) -> t333
View(t333)
devtools::install_github('ebanalyse/ebmarksetshares', auth_token = 'b17cb3c1866f0187c90aad9e501af280c8ab4821', ref = 'trunk')
devtools::install_github('ebanalyse/ebmarketshares', auth_token = 'b17cb3c1866f0187c90aad9e501af280c8ab4821', ref = 'trunk')
devtools::install_github('ebanalyse/ebmarketshares', auth_token = 'b17cb3c1866f0187c90aad9e501af280c8ab4821', ref = 'trunk')
devtools::install_github('ebanalyse/ebmarketshares', auth_token = 'b17cb3c1866f0187c90aad9e501af280c8ab4821', ref = 'trunk')
install.packages("Z:/git/ebmarketshares_0.1.0.tar.gz", repos = NULL, type = "source")
ebmarketshares::live_marketshare_data(60) -> t
View(t)
View(t)
library(magrittr)
library(dplyr)
ebmarketshares::live_marketshare_data(60) %>% write.csv("gallupdata.csv")
getwd()
View(t)
ebmarketshares::live_marketshare_data(60) %>% filter(publication == 'EB')
ebmarketshares::live_marketshare_data(200) %>% filter(publication == 'EB' & lubridate::month(lubriate::ymd(date)) == 12) write.csv("gallupdata.csv")
ebmarketshares::live_marketshare_data(200) %>% filter(publication == 'EB' & lubridate::month(lubriate::ymd(date)) == 12) %>% write.csv("gallupdata.csv")
ebmarketshares::live_marketshare_data(200) %>% filter(publication == 'EB' & lubridate::month(lubridate::ymd(date)) == 12) %>% write.csv("gallupdata.csv")
install.packages("ggrepel")
devto
devtools::load_all(".")
sco_bet_acquire("1920","sco_pl") -> tr
View(tr)
